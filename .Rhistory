#Load in libraries
library(caret)
#Load in libraries
library(lattice)
library(tidyverse)
library(ggplot2)
library(caret)
library(mlbench)
install.packages("mlbench")
library(mlbench)
#Loading in Employee data
employeeData = read.csv("/Users/mingyang/Desktop/SMU/DoingDS_Fall2020/CaseStudy2DDS/CaseStudy2-data.csv",header = TRUE)
summary(employeeData)
#See which column has only unique value
sapply(employeeData,function(col) length(unique(col)))
#Delete column that has only one unique value
to.be.deleted = which(sapply(employeeData,function(col) length(unique(col))==1))
employeeData = employeeData[,-to.be.deleted]
#observe the cleaner set again
summary(employeeData)
#Convert some values into factors
cols.to.factor = c("Attrition","BusinessTravel","Department","EducationField","EnvironmentSatisfaction",
"Gender","JobInvolvement","JobLevel","JobRole","JobSatisfaction","MaritalStatus","NumCompaniesWorked",
"OverTime","PerformanceRating","RelationshipSatisfaction","StockOptionLevel","TrainingTimesLastYear",
"WorkLifeBalance")
employeeData[cols.to.factor] = lapply(employeeData[cols.to.factor],factor)
str(employeeData)
# First discover the percentage of Attrition in the Dataset
table(employeeData$Attrition) # 730 No, 140 Yes
attrition.percent = 140/870
attrition.percent
# Visually look at percentage of Attrition
employeeData %>% ggplot() + geom_bar(aes(x=Attrition),fill="light blue") +
ggtitle("Attrition Count comparison")+ylab("Number of Employee")
# Age with Attrition
employeeData %>% ggplot() + geom_bar(aes(x=Age,fill=Attrition)) +
ggtitle("Attrition with Age")+ylab("Number of Empllyee")
# Age with Attrition Proportion
employeeData %>% ggplot() + geom_bar(aes(x=Age,fill=Attrition),position="fill") +
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition with Age")+ylab("Proportion of Attrition")
#Department
employeeData %>% ggplot()+geom_bar(aes(x=Department,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Department")+ylab("Attrition Rate")
# Distance from Home
employeeData %>% ggplot()+ geom_bar(aes(x=DistanceFromHome,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different distance from Home")+ylab("Attrition Rate")
#Education
employeeData %>% ggplot()+ geom_bar(aes(x=Education,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Education Level")+ylab("Attrition Rate")+xlab("Education Level")
#Education Field
employeeData %>% ggplot()+ geom_bar(aes(x=EducationField,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Education Field")+ylab("Attrition Rate")+xlab("Education Field")
#Environment Satisfaction
employeeData %>% ggplot()+ geom_bar(aes(x=EnvironmentSatisfaction,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Environment Satisfaction Score")+ylab("Attrition Rate")+xlab("Environment Satisfaction")
# Gender
employeeData %>% ggplot()+ geom_bar(aes(x=Gender,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate with Gender")+ylab("Attrition Rate")+xlab("Gender")
# Hourly Rate
employeeData %>% ggplot()+ geom_bar(aes(x=HourlyRate,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Hourly Rate")+ylab("Attrition Rate")+xlab("Hourly Rate")
# Job Involvement
employeeData %>% ggplot()+ geom_bar(aes(x=JobInvolvement,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Job Involvement Levels")+
ylab("Attrition Rate")+xlab("Job Involvement Levels")
# Job Level
employeeData %>% ggplot()+ geom_bar(aes(x=JobLevel,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Job Level")+ylab("Attrition Rate")+xlab("Job Level")
#Job Role
employeeData %>% ggplot()+ geom_bar(aes(x=JobRole,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Job Roles")+ylab("Attrition Rate")+xlab("Job Roles")+coord_flip()
# Job Satisfaction
employeeData %>% ggplot()+ geom_bar(aes(x=JobSatisfaction,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Job Satisfaction Score")+ylab("Attrition Rate")+xlab("Job Satisfaction")
# Marital Status
employeeData %>% ggplot()+ geom_bar(aes(x=MaritalStatus,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under Marital Status")+ylab("Attrition Rate")+xlab("Marital Status")
#Monthly Income
employeeData %>% ggplot(aes(x=MonthlyIncome,fill=Attrition))+ geom_bar(color="black",stat="bin",binwidth=500)+
ggtitle("Attrition count under different Monthly Income")+ylab("Attrition Count")+xlab("Monthly Income group")
#Monthly Rate
employeeData %>% ggplot(aes(x=MonthlyRate,fill=Attrition))+ geom_bar(color="black",stat="bin",binwidth=1000)+
ggtitle("Attrition count under different Monthly Rate")+ylab("Attrition Count")+xlab("Monthly Rate")
#Numbers of Companies Worked
employeeData %>% ggplot()+ geom_bar(aes(x=NumCompaniesWorked,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Number of Companies Worked before")+ylab("Attrition Rate")+xlab("Number of Companies Worked")
# Over Time
employeeData %>% ggplot()+ geom_bar(aes(x=OverTime,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs Overtime")+ylab("Attrition Rate")+xlab("OverTime Or Not")
#Percent Salary Hike
employeeData %>% ggplot()+ geom_bar(aes(x=PercentSalaryHike,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Percent of Salary Hike")+ylab("Attrition Rate")+xlab("Percent of Salary Hike")
#Performance Rating
employeeData %>% ggplot()+ geom_bar(aes(x=PerformanceRating,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Performance Rating")+ylab("Attrition Rate")+xlab("Performance Rating")
#Relationship Satisfaction
employeeData %>% ggplot()+ geom_bar(aes(x=RelationshipSatisfaction,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Relationship Satisfaction Score")+ylab("Attrition Rate")+xlab("Relationship Satisfaction")
#Stock Option Level
employeeData %>% ggplot()+ geom_bar(aes(x=StockOptionLevel,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate under different Stock Option Level")+ylab("Attrition Rate")+xlab("Stock Option Level")
#Total Working Years
employeeData %>% ggplot()+ geom_bar(aes(x=TotalWorkingYears,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs Total Working Years")+ylab("Attrition Rate")+xlab("Total Working Years")
#Training Times Last Year
employeeData %>% ggplot()+ geom_bar(aes(x=TrainingTimesLastYear,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs Training Times Last Year")+ylab("Attrition Rate")+xlab("Training Times Last Year")
#Work Life Balance Score
employeeData %>% ggplot()+ geom_bar(aes(x=WorkLifeBalance,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs Work Life Balance Score")+ylab("Attrition Rate")+xlab("Work Life Balance Score")
# Years At Company
employeeData %>% ggplot()+ geom_bar(aes(x=YearsAtCompany,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs. Years At Company")+ylab("Attrition Rate")+xlab("Years At Company")
# Years in current Role
employeeData %>% ggplot()+ geom_bar(aes(x=YearsInCurrentRole,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs Years in Current Role")+ylab("Attrition Rate")+xlab("Years in current role")
# Years Since Last Promotion
employeeData %>% ggplot()+ geom_bar(aes(x=YearsSinceLastPromotion,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs. Years Since last promotion")+ylab("Attrition Rate")+xlab("Years Since Last Promotion")
# Years With Current Manager
employeeData %>% ggplot()+ geom_bar(aes(x=YearsWithCurrManager,fill=Attrition),position="fill")+
scale_y_continuous(labels = scales::percent)+
ggtitle("Attrition rate vs. Years With Current Manager")+ylab("Attrition Rate")+xlab("Years With Current Manager")
#prepare training scheme
control = trainControl(method="repeatedcv", number=10, repeats=3)
#train the model
model = train(Attrition~.,data=employeeData,method="lvq",preProcess="scale", trControl=control)
#estimate variable importance
importance = varImp(model,scale=FALSE)
#summarize importance
print(importance)
#plot importance
plot(importance)
data.nb = employeeData %>% select(OverTime, MonthlyIncome, TotalWorkingYears, YearsAtCompany, StockOptionLevel, MaritalStatus, JobLevel, YearsInCurrentRole, YearsWithCurrentManager, Age, JobInvolvement, JobSatisfaction, JobRole, Department,EducationLevel, WorkLifeBalance, EnvironmentSatisfaction)
data.nb = employeeData %>% select(OverTime, MonthlyIncome, TotalWorkingYears, YearsAtCompany, StockOptionLevel, MaritalStatus, JobLevel, YearsInCurrentRole, YearsWithCurrManager, Age, JobInvolvement, JobSatisfaction, JobRole, Department,EducationLevel, WorkLifeBalance, EnvironmentSatisfaction)
data.nb = employeeData %>% select(Attrition, OverTime, MonthlyIncome, TotalWorkingYears, YearsAtCompany, StockOptionLevel, MaritalStatus, JobLevel, YearsInCurrentRole, YearsWithCurrManager, Age, JobInvolvement, JobSatisfaction, JobRole, Department,Education, WorkLifeBalance, EnvironmentSatisfaction)
head(data.nb)
set.seed(11)
splitPercent = 0.75
trainIndex = sample(1:dim(data.nb)[1],round(splitPercNB1 * dim(data.nb)[1]))
trainIndex = sample(1:dim(data.nb)[1],round(splitPercent * dim(data.nb)[1]))
set.seed(11)
splitPercent = 0.75
trainIndex = sample(1:dim(data.nb)[1],round(splitPercent * dim(data.nb)[1]))
train.nb = data.nb[trainIndex,]
test.nb = data.nb[-trainIndex,]
?naiveBayes
model.nb = naiveBayes(Attrition~.,data=train.nb, laplace = 1)
#Load NB libraries
library(e1071)
model.nb = naiveBayes(Attrition~.,data=train.nb, laplace = 1)
predict.nb = predict(model.nb,test.nb)
str(test.nb)
table(predict.nb,test.nb$Attrition)
confusionMatrix(predict.nb,test.nb$Attrition)
set.seed(12)
splitPercent = 0.80
trainIndex = sample(1:dim(data.nb)[1],round(splitPercent * dim(data.nb)[1]))
train.nb = data.nb[trainIndex,]
test.nb = data.nb[-trainIndex,]
model.nb = naiveBayes(Attrition~.,data=train.nb, laplace = 1)
predict.nb = predict(model.nb,test.nb)
table(predict.nb,test.nb$Attrition)
confusionMatrix(predict.nb,test.nb$Attrition)
# Now I want to run 100 iterations to get an average accuracy, sensitivity, and specificity rate
set.seed(13)
iterations = 100
masterAcc = matrix(nrow = iterations,ncol=3)
splitPerc = .8 #Training / Test split Percentage
for(j in 1:iterations)
{
trainIndices = sample(1:dim(data.nb)[1],round(splitPerc * dim(data.nb)[1]))
train = data.nb[trainIndices,]
test = data.nb[-trainIndices,]
model = naiveBayes(Attrition~.,data=train,laplace = 1)
CM = confusionMatrix(table(predict(model,test$Attrition),test$Attrition))
masterAcc[j,1] = CM$overall[1]
masterAcc[j,2]=CM$byClass[1]
masterAcc[j,3] = CM$byClass[2]
}
warnings()
MeanAcc = colMeans(masterAcc)
MeanAcc
#select variables decided to predict Attrition
data.nb = employeeData %>% select(Attrition, OverTime, MonthlyIncome, TotalWorkingYears, YearsAtCompany, StockOptionLevel, MaritalStatus, JobLevel, YearsInCurrentRole, YearsWithCurrManager, Age, JobInvolvement, JobSatisfaction, JobRole, Department,Education, WorkLifeBalance, EnvironmentSatisfaction)
set.seed(12)
splitPercent = 0.80
trainIndex = sample(1:dim(data.nb)[1],round(splitPercent * dim(data.nb)[1]))
train.nb = data.nb[trainIndex,]
test.nb = data.nb[-trainIndex,]
model.nb = naiveBayes(Attrition~.,data=train.nb, laplace = 1)
predict.nb = predict(model.nb,test.nb)
table(predict.nb,test.nb)
table(predict.nb,test.nb$Attrition)
confusionMatrix(predict.nb,test.nb$Attrition)
set.seed(13)
iterations = 100
masterAcc = matrix(nrow = iterations,ncol=3)
splitPerc = .8 #Training / Test split Percentage
for(j in 1:iterations)
{
trainIndices = sample(1:dim(data.nb)[1],round(splitPerc * dim(data.nb)[1]))
train = data.nb[trainIndices,]
test = data.nb[-trainIndices,]
model = naiveBayes(Attrition~.,data=train,laplace = 1)
CM = confusionMatrix(table(predict(model,test),test$Attrition))
masterAcc[j,1] = CM$overall[1]
masterAcc[j,2]=CM$byClass[1]
masterAcc[j,3] = CM$byClass[2]
}
MeanAcc = colMeans(masterAcc)
MeanAcc
noAttrition = read.csv("/Users/mingyang/Desktop/SMU/DoingDS_Fall2020/CaseStudy2DDS/CaseStudy2CompSet No Attrition.csv",header = TRUE)
head(noAttrition)
noAttrition[cols.to.factor] = lapply(noAttrition[cols.to.factor],factor)
cols.to.factor
str(noAttrition)
cols.to.factor2 = c("BusinessTravel","Department","EducationField","EnvironmentSatisfaction",
"Gender","JobInvolvement","JobLevel","JobRole","JobSatisfaction","MaritalStatus","NumCompaniesWorked",
"OverTime","PerformanceRating","RelationshipSatisfaction","StockOptionLevel","TrainingTimesLastYear",
"WorkLifeBalance")
noAttrition[cols.to.factor2] = lapply(noAttrition[cols.to.factor2],factor)
#Create prediction set
predictionSet = noAttrition %>% select(Attrition, OverTime, MonthlyIncome, TotalWorkingYears, YearsAtCompany, StockOptionLevel, MaritalStatus, JobLevel, YearsInCurrentRole, YearsWithCurrManager, Age, JobInvolvement, JobSatisfaction, JobRole, Department,Education, WorkLifeBalance, EnvironmentSatisfaction)
#Create prediction set
predictionSet = noAttrition %>% select(OverTime, MonthlyIncome, TotalWorkingYears, YearsAtCompany, StockOptionLevel, MaritalStatus, JobLevel, YearsInCurrentRole, YearsWithCurrManager, Age, JobInvolvement, JobSatisfaction, JobRole, Department,Education, WorkLifeBalance, EnvironmentSatisfaction)
#Retrain the NB model with entire dataset to improve prediction accuracy
model.nb = naiveBayes(Attrition~.,data=data.nb, laplace = 1)
prediction.NoAttrition = predict(model.nb,noAttrition)
prediction.NoAttrition
noAttrition$Attrition = prediction.NoAttrition
results = noAttrition%>%select(ID,Attrition)
results
str(results)
write.csv(results,"Case2PredictionsYU Attrition.csv",row.names = FALSE)
#Load library to run stepwise regression method to choose an optimal simple model
library(MASS)
str(employeeData)
res.lm = lm(MonthlyIncome~.,data=employeeData)
step = stepAIC(res.lm, direction="both", trace=FALSE)
step
train.control <- trainControl(method = "cv", number = 10)
step.model = train(MonthlyIncome~., data=employeeData,
method="lmStepAIC",
trControl = train.control,
trace=FALSE)
#Model Accuracy
step.model$results
step.model$finalModel
summary(step.model$finalModel)
#Build the model
my.linear.model = lm(MontlyIncome ~ ID + BusinessTravelTravel_Frequently +
BusinessTravelTravel_Rarely + DailyRate + DepartmentSales +
JobLevel2 + JobLevel3 + JobLevel4 + JobLevel5 + `JobRoleHuman Resources` +
`JobRoleLaboratory Technician` + JobRoleManager + `JobRoleResearch Director` +
`JobRoleResearch Scientist` + `JobRoleSales Executive` +
`JobRoleSales Representative` + NumCompaniesWorked3 + TotalWorkingYears +
TrainingTimesLastYear2 + TrainingTimesLastYear3 + TrainingTimesLastYear4,
data = employeeData)
#load in CaseStudy2CompSet No Salary.csv to predict monthly salary
noSalary = read.csv("/Users/mingyang/Desktop/SMU/DoingDS_Fall2020/CaseStudy2DDS/CaseStudy2CompSet No Salary.csv",header = TRUE)
cols.to.factor3 = c("Attrition","BusinessTravel","Department","EducationField","EnvironmentSatisfaction",
"Gender","JobInvolvement","JobLevel","JobRole","JobSatisfaction","MaritalStatus","NumCompaniesWorked",
"OverTime","PerformanceRating","RelationshipSatisfaction","StockOptionLevel","TrainingTimesLastYear",
"WorkLifeBalance")
noSalary[cols.to.factor] = lapply(noSalary[cols.to.factor],factor)
prediction.monthlyS = predict(step.model,noSalary)
prediction.monthlyS
noSalary$MonthlyIncome = prediction.monthlyS
results1 = noSalary %>% select(ID,MonthlyIncome)
str(noSalary)
results1 = noSalary %>% select(ID,MonthlyIncome)
results1 = noSalary %>%select(MonthlyIncome)
results1 = noSalary%>%select(ID,Attrition)
library(tidyverse)
results1 = noSalary%>%select(ID,MonthlyIncome)
results1 = noSalary%>%tidyverse::select(ID,MonthlyIncome)
results1 = noSalary %>% tidyverse::select(ID,MonthlyIncome)
results1 = data.frame(c(noSalary$ID,noSalary$MonthlyIncome))
results1
#Write results1 to CaseStudy2CompSet No Salary.csv
write.csv(results1,"Case2PredictionsYU Salary.csv",row.names = FALSE)
noSalary$ID
str(results1)
results1 = data.frame(noSalary$ID,noSalary$MonthlyIncome)
str(results1)
#Write results1 to CaseStudy2CompSet No Salary.csv
write.csv(results1,"Case2PredictionsYU Salary.csv",row.names = FALSE)
summary(step.model$finalModel)
step.model$finalModel
str(employeeData)
employeeData$Department
sapply(employeeData$JobRole, levels)
unique(employeeData$JobRole)
?map
employeeData%>%purrr:map(levels)
#Look at all the job roles
unique(employeeData$JobRole)
employeeData %>% group_by(JobRole) %>% mean(JobSatisfaction)
employeeData %>% group_by(JobRole)
employeeData %>% group_by(JobRole) %>% summarize(mean(JobSatisfaction))
unique(employeeData$JobRole)
#Loading in Employee data
employeeData = read.csv("/Users/mingyang/Desktop/SMU/DoingDS_Fall2020/CaseStudy2DDS/CaseStudy2-data.csv",header = TRUE)
summary(employeeData)
#See which column has only unique value
sapply(employeeData,function(col) length(unique(col)))
#Delete column that has only one unique value
to.be.deleted = which(sapply(employeeData,function(col) length(unique(col))==1))
employeeData = employeeData[,-to.be.deleted]
employeeData %>% group_by(JobRole) %>% summarize(mean(JobSatisfaction))
satisfaction.by.jobrole = employeeData %>% group_by(JobRole) %>% summarize(mean(JobSatisfaction))
str(satisfaction.by.jobrole)
colnames(satisfaction.by.jobrole)
names(satisfaction.by.jobrole)[2]="JobSatisfaction"
satisfaction.by.jobrole
satisfaction.by.jobrole%>% ggplot(aes(x=JobRole,y=JobSatisfaction))+
geom_bar(color="light blue")
satisfaction.by.jobrole%>% ggplot(aes(x=JobRole,y=JobSatisfaction))+
geom_bar(color="light blue",stat="identity")
satisfaction.by.jobrole%>% ggplot(aes(x=JobRole,y=JobSatisfaction))+
geom_bar(fill="light blue",stat="identity")
satisfaction.by.jobrole%>% ggplot(aes(x=JobRole,y=JobSatisfaction))+
geom_bar(fill="light blue",stat="identity") +
coord_flip()
satisfaction.by.jobrole%>% ggplot(aes(reorder(JobRole,JobSatisfaction),JobSatisfaction))+
geom_bar(fill="light blue",stat="identity") +
coord_flip()
satisfaction.by.jobrole%>% ggplot(aes(reorder(JobRole,JobSatisfaction),JobSatisfaction))+
geom_bar(fill="light blue",stat="identity") +
ggtitle("Job role vs Average Job Satisfaction Score")+
xlab("Job Roles")+ ylab("Average Job Satisfaction Score")
satisfaction.by.jobrole%>% ggplot(aes(reorder(JobRole,JobSatisfaction),JobSatisfaction))+
geom_bar(fill="light blue",stat="identity") +
ggtitle("Job role vs Average Job Satisfaction Score")+
xlab("Job Roles")+ ylab("Average Job Satisfaction Score")+
coord_flip()
satisfaction.by.jobrole%>% ggplot(aes(reorder(JobRole,JobSatisfaction),JobSatisfaction))+
geom_bar(fill="blue",stat="identity") +
ggtitle("Job role vs Average Job Satisfaction Score")+
xlab("Job Roles")+ ylab("Average Job Satisfaction Score")+
coord_flip()
t.test(MonthlyIncome ~ Gender, data = employeeData)
?t.test
t.test(MonthlyIncome ~ Gender, data = employeeData, conf.level=0.95)
t.test(MonthlyIncome ~ Gender, data = employeeData, conf.level=0.05)
t.test(MonthlyIncome ~ Gender, data = employeeData, conf.level=0.95)
t.test(PercentSalaryHike~Gender,data=employeeData,conf.level=0.95)
work.life.balance = employeeData %>% group_by(JobRole) %>% summarize(mean(WorkLifeBalance))
str(work.life.balance)
names(work.life.balance)[2]="WorkLifeBalance"
work.life.balance%>% ggplot(aes(reorder(JobRole,WorkLifeBalance),WorkLifeBalance))+
geom_bar(fill="blue",stat="identity") +
ggtitle("Job role vs Average Work Life Balance Score")+
xlab("Job Roles")+ ylab("Average Work Life Balance Score")+
coord_flip()
#Model Accuracy
step.model$results
str(employeeData)
